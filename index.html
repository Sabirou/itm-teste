<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Mousquetaires - Portail QHSE 2026</title>
    
    <!-- Polices modernes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Poppins:wght@500;700;900&display=swap" rel="stylesheet">
    
    <!-- Ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Moteurs JS (Graphiques, 3D, Animation) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <style>
        /* ================= VARIABLES ================= */
        :root {
            --primary: #E2001A; /* Rouge Mousquetaires */
            --primary-dark: #820720;
            --dark: #0a0a0a;
            --dark-light: #1a1a1a;
            --gray: #f3f4f6;
            --text: #1f2937;
            --white: #ffffff;
            --sidebar-width: 280px;
            --header-height: 80px;
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* ================= LOAD SCREEN (CIN√âMATIQUE) ================= */
        #page-loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #0a0a0a;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        #page-loader.active {
            opacity: 1;
            pointer-events: all;
        }

        .loader-content { text-align: center; overflow: hidden; }

        .loader-title {
            font-family: 'Poppins', sans-serif;
            font-size: 3rem; font-weight: 900; color: white;
            letter-spacing: 5px; text-transform: uppercase;
            opacity: 0; transform: translateY(20px);
        }

        .loader-subtitle {
            font-family: 'Inter', sans-serif; font-size: 1rem; color: var(--primary);
            letter-spacing: 8px; margin-top: 10px; text-transform: uppercase;
            opacity: 0;
        }

        .loader-bar {
            width: 0%; height: 4px; background: var(--primary);
            margin-top: 30px; border-radius: 2px;
            box-shadow: 0 0 20px var(--primary);
        }

        /* Animation Classes */
        .loading .loader-title { animation: textReveal 0.8s cubic-bezier(0.2, 1, 0.3, 1) forwards; }
        .loading .loader-subtitle { animation: textReveal 0.8s cubic-bezier(0.2, 1, 0.3, 1) 0.2s forwards; }
        .loading .loader-bar { animation: loadProgress 1.2s ease-in-out forwards; }

        @keyframes textReveal { to { opacity: 1; transform: translateY(0); } }
        @keyframes loadProgress { 0% { width: 0%; } 50% { width: 60%; } 100% { width: 100%; } }

        /* ================= CSS BASE ================= */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; color: var(--text); overflow-x: hidden; }
        h1, h2, h3 { font-family: 'Poppins', sans-serif; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, #111 0%, #1a1a1a 100%);
            color: var(--white);
            height: 100vh;
            position: fixed;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 10px 0 30px rgba(0,0,0,0.3);
            transition: var(--transition);
        }

        .brand {
            padding: 25px; display: flex; align-items: center; gap: 15px;
            background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .brand img { width: 45px; height: 45px; background: white; border-radius: 10px; padding: 5px; object-fit: contain; }
        .brand-text h2 { font-size: 14px; font-weight: 700; letter-spacing: 0.5px; }
        .brand-text span { font-size: 11px; opacity: 0.7; }

        .menu-category { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: rgba(255,255,255,0.4); padding: 25px 25px 10px; font-weight: 700; }
        
        .nav-item {
            padding: 14px 25px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: var(--transition);
            border-left: 4px solid transparent; font-size: 14px;
            position: relative; overflow: hidden;
        }
        .nav-item::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, rgba(226,0,26,0.2), transparent);
            transform: translateX(-100%); transition: var(--transition);
        }
        .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.05); border-left-color: var(--primary); }
        .nav-item:hover::before, .nav-item.active::before { transform: translateX(0); }
        .nav-item i { width: 20px; text-align: center; transition: var(--transition); }
        .nav-item:hover i { transform: scale(1.2); color: var(--primary); }

        .submenu { max-height: 0; overflow: hidden; transition: 0.5s ease; background: rgba(0,0,0,0.2); }
        .submenu.open { max-height: 500px; }
        .submenu .nav-item { padding-left: 55px; font-size: 13px; border: none; }

        /* MAIN CONTENT */
        .main { margin-left: var(--sidebar-width); flex: 1; padding-top: var(--header-height); transition: var(--transition); }

        .topbar {
            height: var(--header-height); background: rgba(255,255,255,0.9);
            backdrop-filter: blur(20px); position: fixed; top: 0; right: 0;
            width: calc(100% - var(--sidebar-width)); z-index: 900;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            transition: var(--transition);
        }

        .search-box input {
            width: 400px; padding: 12px 20px 12px 50px;
            border-radius: 30px; border: none; background: var(--gray);
            font-family: inherit; transition: var(--transition);
        }
        .search-box input:focus { background: var(--white); box-shadow: 0 0 0 4px rgba(226,0,26,0.1); outline: none; }
        .search-box { position: relative; }
        .search-box i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #6b7280; }

        .user-menu { display: flex; gap: 20px; align-items: center; }
        .icon-btn {
            width: 45px; height: 45px; border-radius: 12px; background: var(--white);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: var(--transition); position: relative;
        }
        .icon-btn:hover { transform: translateY(-3px); color: var(--primary); }
        .badge {
            position: absolute; top: -5px; right: -5px;
            background: var(--primary); color: white; font-size: 10px;
            width: 20px; height: 20px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(226,0,26,0.7); } 70% { box-shadow: 0 0 0 10px rgba(226,0,26,0); } 100% { box-shadow: 0 0 0 0 rgba(226,0,26,0); } }

        /* PAGES */
        .page { display: none; padding: 40px; animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

        /* 3D CARDS */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .card-3d {
            background: var(--white); border-radius: 20px; padding: 30px;
            transform-style: preserve-3d; transform: perspective(1000px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.1); cursor: pointer;
        }
        .card-content { transform: translateZ(30px); }
        .card-value { font-size: 3rem; font-weight: 800; color: var(--dark); line-height: 1; margin-bottom: 5px; }
        .card-icon { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 20px; }
        .card-icon.red { background: #ff4757; color: white; }
        .card-icon.green { background: #2ed573; color: white; }
        .card-icon.blue { background: #1e90ff; color: white; }
        .card-icon.orange { background: #ffa502; color: white; }

        /* DASHBOARD LAYOUT */
        .glass-panel {
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px);
            border-radius: 20px; padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.5);
        }
        .dashboard-row { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 40px; }
        #canvas3d { width: 100%; height: 350px; border-radius: 15px; background: #1a1a1a; position: relative; overflow: hidden; }

        /* QUICK LINKS */
        .grid-links { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 20px; }
        .link-item {
            background: white; border-radius: 15px; padding: 20px 10px;
            text-align: center; cursor: pointer; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03); border: 1px solid transparent;
        }
        .link-item:hover { transform: translateY(-5px); border-color: var(--primary); }
        .link-item i { font-size: 28px; margin-bottom: 10px; color: var(--primary); }

        /* DOCS LIST */
        .doc-list { display: flex; flex-direction: column; gap: 10px; }
        .doc-row {
            display: flex; align-items: center; gap: 15px; padding: 15px;
            background: white; border-radius: 12px; cursor: pointer; transition: 0.2s;
        }
        .doc-row:hover { transform: translateX(10px); border-left: 4px solid var(--primary); }
        .file-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .pdf { background: #ffe5e5; color: #ff4757; }
        .xls { background: #e5ffe5; color: #2ed573; }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main, .topbar { margin-left: 0; width: 100%; }
            .dashboard-row { grid-template-columns: 1fr; }
            #menu-toggle { display: block !important; margin-right: 20px; font-size: 24px; cursor: pointer; }
        }
        #menu-toggle { display: none; }

    </style>
</head>
<body>

    <!-- 1. SCREEN LOADER (Animation Cin√©matique) -->
    <div id="page-loader">
        <div class="loader-content">
            <div class="loader-title">LES MOUSQUETAIRES</div>
            <div class="loader-subtitle">LOGISTIQUE BRIGNOLES</div>
            <div class="loader-bar"></div>
        </div>
    </div>

    <!-- 2. SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="brand">
            <!-- Image Locale avec Fallback -->
            <img src="logo-groupement.svg" onerror="this.src='https://upload.wikimedia.org/wikipedia/fr/thumb/8/84/Intermarch%C3%A9-logo.svg/1200px-Intermarch%C3%A9-logo.svg.png'" alt="Logo">
            <div class="brand-text">
                <h2>Les Mousquetaires</h2>
                <span>Brignoles - Logistique</span>
            </div>
        </div>

        <div class="menu-category">G√©n√©ral</div>
        <div class="nav-item active" onclick="showPage('home', this)">
            <i class="fas fa-home"></i> <span>Vue d'ensemble</span>
        </div>

        <div class="menu-category">Op√©rations</div>
        <div class="nav-item" onclick="toggleSubmenu('sub-proc', this)">
            <i class="fas fa-clipboard-list"></i> <span>Proc√©dures</span>
            <i class="fas fa-chevron-down" style="margin-left: auto; font-size: 10px;"></i>
        </div>
        <div class="submenu" id="sub-proc">
            <div class="nav-item" onclick="showPage('reception', this)">R√©ception</div>
            <div class="nav-item" onclick="showPage('stock', this)">Stock & Entrep√¥t</div>
            <div class="nav-item" onclick="showPage('expedition', this)">Exp√©ditions</div>
        </div>

        <div class="menu-category">S√©curit√© & Qualit√©</div>
        <div class="nav-item" onclick="showPage('securite', this)">
            <i class="fas fa-shield-alt"></i> <span>Incendie & POI</span>
        </div>
        <div class="nav-item" onclick="showPage('qualite', this)">
            <i class="fas fa-check-circle"></i> <span>Qualit√© & Hygi√®ne</span>
        </div>
        <div class="nav-item" onclick="showPage('accidents', this)">
            <i class="fas fa-user-injured"></i> <span>Suivi AT / incidents</span>
        </div>

        <div class="menu-category">Outils</div>
        <div class="nav-item" onclick="showPage('stats', this)">
            <i class="fas fa-chart-pie"></i> <span>Indicateurs 2026</span>
        </div>
        <div class="nav-item" onclick="showPage('docs', this)">
            <i class="fas fa-folder-open"></i> <span>GED Documentaire</span>
        </div>
        <div class="nav-item" onclick="showPage('coordonnees', this)">
            <i class="fas fa-address-book"></i> <span>Coordonn√©es</span>
        </div>
    </nav>

    <!-- 3. MAIN CONTENT -->
    <div class="main">
        <!-- TOPBAR -->
        <div class="topbar">
            <div style="display:flex; align-items:center;">
                <i class="fas fa-bars" id="menu-toggle" onclick="toggleSidebar()"></i>
                <h2 id="page-title">Tableau de Bord</h2>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Rechercher une proc√©dure, un document...">
            </div>

            <div class="user-menu">
                <div class="icon-btn" onclick="showPage('qualite', null)">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </div>
                <div class="icon-btn">
                    <i class="fas fa-cog"></i>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <div style="text-align:right;">
                        <div style="font-weight:700; font-size:14px;">Admin</div>
                        <div style="font-size:11px; color:#888;">Resp. QHSE</div>
                    </div>
                    <img src="https://ui-avatars.com/api/?name=Admin+Mousquetaire&background=E2001A&color=fff" style="width:40px; height:40px; border-radius:50%;">
                </div>
            </div>
        </div>

        <!-- ================= PAGE: HOME ================= -->
        <div id="home" class="page active">
            <h2 style="margin-bottom:30px;">Vue d'ensemble - Logistique Brignoles 2026</h2>

            <!-- 3D Stats Cards (Tilt Effect) -->
            <div class="stats-grid">
                <div class="card-3d" data-tilt data-tilt-glare data-tilt-max="10" onclick="showPage('qualite', null)">
                    <div class="card-content">
                        <div class="card-icon green"><i class="fas fa-check"></i></div>
                        <div class="card-value count-up" data-target="98.5">0</div>
                        <div class="card-label">Taux Conformit√©</div>
                        <div class="trend up"><i class="fas fa-arrow-up"></i> +2.4%</div>
                    </div>
                </div>

                <div class="card-3d" data-tilt data-tilt-glare data-tilt-max="10" onclick="showPage('accidents', null)">
                    <div class="card-content">
                        <div class="card-icon blue"><i class="fas fa-user-shield"></i></div>
                        <div class="card-value count-up" data-target="45">0</div>
                        <div class="card-label">Jours sans AT</div>
                        <div class="trend up">Record ann√©e</div>
                    </div>
                </div>

                <div class="card-3d" data-tilt data-tilt-glare data-tilt-max="10" onclick="showPage('stats', null)">
                    <div class="card-content">
                        <div class="card-icon orange"><i class="fas fa-boxes"></i></div>
                        <div class="card-value count-up" data-target="1250">0</div>
                        <div class="card-label">Palettes R√©ception</div>
                        <div class="trend up">+15% vs N-1</div>
                    </div>
                </div>

                <div class="card-3d" data-tilt data-tilt-glare data-tilt-max="10" onclick="showPage('qualite', null)">
                    <div class="card-content">
                        <div class="card-icon red"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="card-value">1</div>
                        <div class="card-label">Alerte Qualit√©</div>
                        <div class="trend down">Action Requise</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Row (3D Model + Chart) -->
            <div class="dashboard-row">
                <!-- 3D Warehouse Visualization -->
                <div class="glass-panel">
                    <h3 style="margin-bottom:20px;">üì¶ Visualisation Entrep√¥t (Temps R√©el)</h3>
                    <div id="canvas3d"></div>
                </div>

                <!-- Access Rapide -->
                <div class="glass-panel">
                    <h3 style="margin-bottom:20px;">‚ö° Acc√®s Rapide</h3>
                    <div class="grid-links">
                        <div class="link-item" onclick="showPage('reception', null)">
                            <i class="fas fa-truck-loading"></i>
                            <span>R√©ception</span>
                        </div>
                        <div class="link-item" onclick="showPage('securite', null)">
                            <i class="fas fa-fire-extinguisher"></i>
                            <span>Incendie</span>
                        </div>
                        <div class="link-item" onclick="showPage('docs', null)">
                            <i class="fas fa-flask"></i>
                            <span>FDS</span>
                        </div>
                        <div class="link-item" onclick="showPage('docs', null)">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Formation</span>
                        </div>
                        <div class="link-item" onclick="showPage('docs', null)">
                            <i class="fas fa-file-contract"></i>
                            <span>Proc√©dures</span>
                        </div>
                        <div class="link-item" onclick="showPage('stats', null)">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Planning</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="glass-panel">
                <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                    <h3>üìä Performance Hebdomadaire</h3>
                </div>
                <div style="height:300px; width:100%;">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ================= PAGE: RECEPTION ================= -->
        <div id="reception" class="page">
            <h2 style="margin-bottom:20px;">Proc√©dures de R√©ception</h2>
            <div class="glass-panel">
                <div class="doc-list">
                    <div class="doc-row" onclick="alert('T√©l√©chargement du PDF...')">
                        <div class="file-icon pdf"><i class="fas fa-file-pdf"></i></div>
                        <div>
                            <h4>Protocole de D√©chargement 2026</h4>
                            <span style="font-size:12px; color:#888;">Mis √† jour le 12/01/2026</span>
                        </div>
                        <i class="fas fa-download" style="margin-left:auto; opacity:0.5;"></i>
                    </div>
                    <div class="doc-row" onclick="alert('T√©l√©chargement du PDF...')">
                        <div class="file-icon pdf"><i class="fas fa-file-pdf"></i></div>
                        <div>
                            <h4>Contr√¥le Temp√©rature √† R√©ception</h4>
                            <span style="font-size:12px; color:#888;">Proc√©dure obligatoire</span>
                        </div>
                        <i class="fas fa-download" style="margin-left:auto; opacity:0.5;"></i>
                    </div>
                    <div class="doc-row" onclick="alert('Ouverture Excel...')">
                        <div class="file-icon xls"><i class="fas fa-file-excel"></i></div>
                        <div>
                            <h4>Suivi des Litiges Transport</h4>
                            <span style="font-size:12px; color:#888;">Fichier Excel partag√©</span>
                        </div>
                        <i class="fas fa-download" style="margin-left:auto; opacity:0.5;"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= PAGE: SECURITE ================= -->
        <div id="securite" class="page">
            <h2 style="margin-bottom:20px;">S√©curit√© & Incendie (POI)</h2>
            <div class="dashboard-row">
                <div class="glass-panel">
                    <h3>üìç Plan d'√âvacuation Interactif</h3>
                    <div style="height:300px; background:#eee; border-radius:15px; display:flex; align-items:center; justify-content:center; margin-top:20px; border:2px dashed #ccc;">
                        <p style="color:#888"><i class="fas fa-map-marked-alt"></i> Carte Interactive en cours de chargement...</p>
                    </div>
                </div>
                <div class="glass-panel">
                    <h3>Documents Urgents</h3>
                    <div class="doc-list">
                        <div class="doc-row" onclick="alert('Ouverture PDF')">
                            <div class="file-icon pdf"><i class="fas fa-file-medical"></i></div>
                            <div><h4>Fiche R√©flexe POI</h4></div>
                        </div>
                        <div class="doc-row" onclick="alert('Ouverture PDF')">
                            <div class="file-icon pdf"><i class="fas fa-users"></i></div>
                            <div><h4>Liste Sauveteurs SST</h4></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= PAGE: QUALITE ================= -->
        <div id="qualite" class="page">
            <h2 style="margin-bottom:20px;">Qualit√© & Hygi√®ne</h2>
            <div class="glass-panel" style="border-left: 5px solid var(--primary);">
                <h3 style="color:var(--primary)"><i class="fas fa-exclamation-circle"></i> Retrait Produit en cours</h3>
                <p style="margin-top:10px;"><strong>Produit :</strong> Jambon Sup√©rieur Tranch√©</p>
                <p><strong>Lot :</strong> #4852</p>
                <p><strong>Action :</strong> Retrait imm√©diat et isolement en zone quarantaine.</p>
                <button style="margin-top:15px; padding:10px 20px; background:var(--primary); color:white; border:none; border-radius:5px; cursor:pointer;" onclick="alert('Retrait confirm√© !')">Confirmer le retrait</button>
            </div>
        </div>

        <!-- ================= PAGE: COORDONNEES ================= -->
        <div id="coordonnees" class="page">
            <h2 style="margin-bottom:20px;">Coordonn√©es & Plans</h2>
            <div class="glass-panel">
                <p><strong>Urgence :</strong> 04 94 00 00 00</p>
                <p><strong>Poste de Garde :</strong> 04 94 00 00 01</p>
                <p><strong>Responsable QHSE :</strong> 06 00 00 00 00</p>
            </div>
        </div>

        <!-- Placeholders pour autres pages -->
        <div id="stock" class="page"><h2>Stock</h2><div class="glass-panel"><p>Contenu Stock...</p></div></div>
        <div id="expedition" class="page"><h2>Exp√©ditions</h2><div class="glass-panel"><p>Contenu Exp√©ditions...</p></div></div>
        <div id="accidents" class="page"><h2>Accidents</h2><div class="glass-panel"><p>Contenu Accidents...</p></div></div>
        <div id="stats" class="page"><h2>Indicateurs</h2><div class="glass-panel"><p>Contenu Stats...</p></div></div>
        <div id="docs" class="page"><h2>GED</h2><div class="glass-panel"><p>Base documentaire...</p></div></div>

    </div>

    <!-- ================= LOGIC & SCRIPTS ================= -->
    <script>
        // 1. LOADER CIN√âMATIQUE
        function triggerLoader(callback) {
            const loader = document.getElementById('page-loader');
            const content = loader.querySelector('.loader-content');
            
            loader.classList.add('active');
            content.classList.add('loading');

            // Dur√©e 1.2s pour l'effet "Wow"
            setTimeout(() => {
                if(callback) callback();
                loader.classList.remove('active');
                content.classList.remove('loading');
            }, 1200);
        }

        // 2. NAVIGATION (Fixe pour tous les liens)
        function showPage(pageId, element) {
            triggerLoader(() => {
                // Masquer toutes les pages
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                
                // Afficher la page cible
                const target = document.getElementById(pageId);
                if(target) {
                    target.classList.add('active');
                    window.scrollTo(0,0);
                } else {
                    console.log("Page introuvable, retour accueil");
                    document.getElementById('home').classList.add('active');
                }

                // G√©rer le menu actif
                if(element) {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    if(!element.parentElement.classList.contains('submenu')) {
                        element.classList.add('active');
                    }
                }

                // Titre
                const titles = {
                    'home': 'Tableau de Bord',
                    'reception': 'R√©ception',
                    'securite': 'S√©curit√© Incendie',
                    'qualite': 'Qualit√© & Hygi√®ne',
                    'stats': 'Indicateurs'
                };
                document.getElementById('page-title').innerText = titles[pageId] || "Tableau de Bord";

                // Fermer menu mobile
                if(window.innerWidth <= 1024) document.getElementById('sidebar').classList.remove('active');
            });
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
        
        function toggleSubmenu(id, el) {
            document.getElementById(id).classList.toggle('open');
            el.querySelector('.fa-chevron-down').style.transform = document.getElementById(id).classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        // 3. EFFETS 3D & COMPTEURS
        document.addEventListener("DOMContentLoaded", () => {
            triggerLoader(); // Intro au chargement

            setTimeout(() => {
                document.querySelectorAll('.count-up').forEach(c => {
                    const target = parseFloat(c.getAttribute('data-target'));
                    anime({
                        targets: c, innerHTML: [0, target],
                        round: 10, easing: 'easeOutExpo', duration: 2500
                    });
                });
            }, 1300);
        });

        // 4. MOTEUR 3D (Cubes Rotatifs)
        function init3D() {
            const container = document.getElementById('canvas3d');
            if(!container) return;
            
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.z = 5; camera.position.y = 2; camera.lookAt(0,0,0);
            
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            
            const ambient = new THREE.AmbientLight(0xffffff, 0.6); scene.add(ambient);
            const light = new THREE.DirectionalLight(0xffffff, 1); light.position.set(5,5,5); scene.add(light);

            const group = new THREE.Group();
            const geo = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            
            const matRed = new THREE.MeshStandardMaterial({ color: 0xE2001A });
            const matGray = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const matWhite = new THREE.MeshStandardMaterial({ color: 0xffffff });

            const c1 = new THREE.Mesh(geo, matRed); c1.position.x = -1.2; group.add(c1);
            const c2 = new THREE.Mesh(geo, matGray); c2.position.x = 0; group.add(c2);
            const c3 = new THREE.Mesh(geo, matWhite); c3.position.x = 1.2; group.add(c3);
            const c4 = new THREE.Mesh(geo, matRed); c4.position.y = 1; group.add(c4);

            scene.add(group);

            function animate() {
                requestAnimationFrame(animate);
                group.rotation.y += 0.005;
                group.rotation.x = Math.sin(Date.now() * 0.001) * 0.1;
                renderer.render(scene, camera);
            }
            animate();
        }
        setTimeout(init3D, 500);

        // 5. GRAPHIQUE
        const ctx = document.getElementById('mainChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(226, 0, 26, 0.5)');
        gradient.addColorStop(1, 'rgba(226, 0, 26, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'],
                datasets: [{
                    label: 'Productivit√©',
                    data: [1200, 1500, 1100, 1800, 2000, 1600, 900],
                    borderColor: '#E2001A', backgroundColor: gradient,
                    fill: true, tension: 0.4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } } } }
        });
    </script>
</body>
</html>